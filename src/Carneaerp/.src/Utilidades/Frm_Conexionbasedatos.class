' Gambas class file


Public Sub Form_Open()

  Me.Center
  Me.title = "Conexion a la base de datos"
  TxtHost.Text = "localhost"
  TxtPuerto.text = "3306"
    If Exist(fmain.DirConexion & "/conexion.conf") Then
    CargarDatosConexion()    
  Endif
End
Private Sub CargarDatosConexion()

  TxtHost.text = FMain.FicheroConexionBD["ConexionBD/Host"]
  TxtPuerto.text = FMain.FicheroConexionBD["ConexionBD/Puerto"]
  TxtUsuario.text = FMain.FicheroConexionBD["ConexionBD/Usuario"]
  TxtPassword.Text = Utilidades.cripto(2, FMain.FicheroConexionBD["ConexionBD/Password"])
  TxtBaseDatos.text = FMain.FicheroConexionBD["ConexionBD/BaseDatos"]
   
End

Public Sub BtnSalir_Click()
  Me.Close
End

Public Sub BtnAceptar_Click()
  Dim Cadena As String
  Dim Fichero As File
  Dim Validar As Boolean = True
  Dim FicheroConexionBD As Settings
  FicheroConexionBD = New Settings(fmain.DirConexion & "/conexion.conf")
  If TxtHost.text = "" Then
    Balloon.Error("Debe introducir direccion IP, si es el mismo equipo LOCALHOST", TxtHost)
    validar = False
  Else
    Balloon.Hide(TxtHost)
  Endif
  
  If TxtPuerto.text = "" Then
    Balloon.Error("Debe introducir puerto normalmente es 3306", TxtPuerto)
    validar = False
  Else
    Balloon.Hide(TxtPuerto)
  Endif
  
   If TxtUsuario.text = "" Then
    Balloon.Error("Debe introducir usuario de acceso a la base de datos", TxtUsuario)
    validar = False
  Else
    Balloon.Hide(TxtUsuario)
  Endif
  
  If TxtPassword.text = "" Then
    Balloon.Error("Debe introducir contrase√±a de usuario", TxtPassword)
    validar = False
  Else
    Balloon.Hide(TxtPassword)
  Endif
  
  If TxtBaseDatos.text = "" Then
    Balloon.Error("Debe introducir nombre de la base de datos", TxtBaseDatos)
    validar = False
  Else
    Balloon.Hide(TxtBaseDatos)
  Endif
  
  If validar Then
    
    
    Try fmain.Conexion_Base_Datos.Open
      fmain.Conexion_Base_Datos.Close
    If Error Then
      Message.Error("Error en datos de conexion. Revise la configuracion.")
    Else 
      LblDatosActualizados.Visible = True
      FicheroConexionBD["ConexionBD/Host"] = TxtHost.Text
      FicheroConexionBD["ConexionBD/Puerto"] = TxtPuerto.text
      FicheroConexionBD["ConexionBD/Usuario"] = TxtUsuario.text
      FicheroConexionBD["ConexionBD/Password"] = Utilidades.cripto(1, TxtPassword.text)
      FicheroConexionBD["ConexionBD/BaseDatos"] = TxtBaseDatos.text
      FicheroConexionBD.Save
      fmain.Conexion_Base_Datos.Type = "mysql"
      fmain.Conexion_Base_Datos.Host = TxtHost.Text
      fmain.Conexion_Base_Datos.Port = TxtPuerto.Text
      fmain.Conexion_Base_Datos.User = TxtUsuario.Text
      fmain.Conexion_Base_Datos.Password = TxtPassword.Text
      fmain.Conexion_Base_Datos.Name = TxtBaseDatos.Text
      Me.Close
    Endif  
  Endif
   
End

Public Sub TxtHost_KeyPress()

  If Key.Code = Key.Return Or Key.Code = Key.Enter Then
   TxtPuerto.SetFocus
  Endif

End

Public Sub TxtPuerto_KeyPress()

  If Key.Code = Key.Return Or Key.Code = Key.Enter Then
   TxtUsuario.SetFocus
  Endif

End

Public Sub TxtUsuario_KeyRelease()

  If Key.Code = Key.Return Or Key.Code = Key.Enter Then
   TxtPassword.SetFocus
  Endif

End

Public Sub TxtPassword_KeyRelease()

  If Key.Code = Key.Return Or Key.Code = Key.Enter Then
   TxtBaseDatos.SetFocus
  Endif

End
