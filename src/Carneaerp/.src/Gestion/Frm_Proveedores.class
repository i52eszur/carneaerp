' Gambas class file


Public Sub Form_Open()

  Me.Title = "GESTION DE PROVEEDORES"
  TxtCodigo.SetFocus
  Utilidades.Llenar_Listbox("select * from materiaprima", LtBMP, "nombre")
  Configurar_DataSet_Proveedores()
  Configurar_Datagrid_Comerciales()
End





Public Sub BtnSalirProveedores_Click()

  Me.Close

End


'' Botones de Añadir y Borrar Telefonos
Public Sub BtnAgregarTelefono_Click()

  If TxtTelefono.text = "" Then
    Balloon.Error("Introduzca telefono antes de añadir", TxtTelefono)
    TxtTelefono.SetFocus
  Else If Not IsNumber(TxtTelefono.Text) 
    Balloon.Error("El Telefono es un dato Numerico", TxtTelefono)
    TxtTelefono.SetFocus
  Else If TxtTelefono.Length < 9
    Balloon.Error("Al Telefono le faltan digitos ", TxtTelefono)
    TxtTelefono.SetFocus
  Else
      LtbTelefono.Add(TxtTelefono.Text)
      TxtTelefono.Text = ""
  Endif

End

Public Sub BtnBorrarTelefono_Click()

  Dim Contar_Seleccionados As Integer
  Dim Numero_Telefonos As Integer
  Dim i As Integer
  Numero_Telefonos = LtbTelefono.Count
  Contar_Seleccionados = 0
  For i = 0 To Numero_Telefonos - 1
    If LtbTelefono[i].Selected Then
      Contar_Seleccionados = Contar_Seleccionados + 1
    Endif
  Next
  If Numero_Telefonos > 0 And Contar_Seleccionados > 0 Then
    If LtbTelefono.Current.Selected Then
      LtbTelefono.Remove(LtbTelefono.Index)
    Endif
  Endif

End
''Botones de Añadir y Borrar Fax


Public Sub BtnAgregarFax_Click()

  If TxtFax.text = "" Then
    Balloon.Error("Introduzca Fax antes de añadir", TxtFax)
    TxtFax.SetFocus
  Else If Not IsNumber(TxtFax.Text) 
    Balloon.Error("El Fax es un dato Numerico", TxtFax)
    TxtFax.SetFocus
  Else If TxtFax.Length < 9
    Balloon.Error("Al Fax le faltan digitos ", TxtFax)
    TxtFax.SetFocus
  Else
      LtbFax.Add(TxtFax.Text)
      TxtFax.Text = ""
  Endif

End

Public Sub BtnBorrarFax_Click()

  Dim Contar_Seleccionados As Integer
  Dim Numero_Fax As Integer
  Dim i As Integer
  Numero_Fax = LtbFax.Count
  Contar_Seleccionados = 0
  For i = 0 To Numero_Fax - 1
    If LtbFax[i].Selected Then
      Contar_Seleccionados = Contar_Seleccionados + 1
    Endif
  Next
  If Numero_Fax > 0 And Contar_Seleccionados > 0 Then
    If LtbFax.Current.Selected Then
      LtbFax.Remove(LtbFax.Index)
    Endif
  Endif

End
'' Configuracion de los botones de pasar Las materias primas
Public Sub BtnAgregarMP_Click()

  Dim Contador As Integer
  Dim i As Integer
  Dim Lista_Seleccionados As New String[]
  Dim Lista_NoSeleccionados As New String[]
  Contador = LtBMP.Count
  For i = 0 To Contador - 1 
    If LtBMP[i].Selected Then
      Lista_Seleccionados.Add(LtBMP[i].Text)
    Else
      Lista_NoSeleccionados.Add(LtBMP[i].Text)
    
    Endif
  Next
  ' Añádimos a LtBKMPComposicion los seleccionados
  contador = Lista_Seleccionados.Count
  For i = 0 To contador - 1
    LtBMPProveedor.Add(Lista_Seleccionados[i])
  Next
' Borramos ltBKMP y agregamos los que no hemos seleccionado.
    contador = Lista_NoSeleccionados.Count
    LtBMP.Clear
    For i = 0 To contador - 1
      LtBMP.Add(Lista_NoSeleccionados[i])
    Next
    LtBMP.UnselectAll

End

Public Sub BtnBorrarMP_Click()

  Dim Contador As Integer
  Dim i As Integer
  Dim Lista_Seleccionados As New String[]
  Dim Lista_NoSeleccionados As New String[]
  Contador = LtBMPProveedor.Count
  For i = 0 To Contador - 1 
    If LtBMPProveedor[i].Selected Then
      Lista_Seleccionados.Add(LtBMPProveedor[i].Text)
    Else
      Lista_NoSeleccionados.Add(LtBMPProveedor[i].Text)
    
    Endif
  Next
  ' Añádimos a LtBKMP los seleccionados
  contador = Lista_Seleccionados.Count
  For i = 0 To contador - 1
    LtBMP.Add(Lista_Seleccionados[i])
  Next
' Borramos ltBKMPComposicion y agregamos los que no hemos seleccionado.
    contador = Lista_NoSeleccionados.Count
    LtBMPProveedor.Clear
  For i = 0 To contador - 1
    LtBMPProveedor.Add(Lista_NoSeleccionados[i]) 
  Next
' Deseleccionamos todos ya que se quedan seleccionados
  LtBMPProveedor.UnselectAll

End
'' Botones de Agregar, Borrar y Editar proveedores
Public Sub BtnAgregarProveedor_Click()

  Dim Sql As String
  Dim Contador As Integer
  Dim i As Integer
  Dim C_MateriaPrima As String
  Dim Numero_fila As Integer
  If Comprobar_Campos_Proveedor("AGREGAR") Then
    'Insertamos en la tabla Vendedor
    sql = "insert into proveedor (codigoproveedor,razonsocial,direccion,localidad,provincia,codigopostal,nif,web,email)" &
    " values('" & UCase(TxtCodigo.Text) & "','" & UCase(TxtRazonSocial.Text) & "','" & UCase(TxtDireccion.Text) & "','" & UCase(TxtLocalidad.Text) & "','" & UCase(TxtProvincia.Text) & 
    "','" & UCase(TxtCodigoPostal.Text) & "','" & UCase(TxtNif.Text) & "','" & TxtWeb.Text & "','" & TxtEmail.Text & "')"
    utilidades.In_Act_Bor(sql)   
    'Insertamos datos en la tabla Proveedor Telefono
    If LtbTelefono.Count > 0 Then
      For i = 0 To LtbTelefono.Count - 1
        sql = "insert into proveedortelefono (telefono,proveedor) values('" & LtbTelefono[i].Text & "','" & UCase(TxtCodigo.Text) & "')"
        Utilidades.In_Act_Bor(sql)
      Next
    Endif
    'Insertamos datos en la tabla Proveedor Fax
    If LtbFax.Count > 0 Then
      For i = 0 To LtbFax.Count - 1
        sql = "insert into proveedorfax (fax,proveedor) values('" & LtbFax[i].Text & "','" & UCase(TxtCodigo.Text) & "')"
        Utilidades.In_Act_Bor(sql)
      Next
    Endif
    ' Insertamos los datos en al tabla Proveedor MateriaPrima   
    Contador = LtBMPProveedor.Count
    For i = 0 To Contador - 1
      sql = "select * from materiaprima where nombre='" & LtBMPProveedor[i].Text & "'"
      C_Materiaprima = Utilidades.Obtener_Campo_Tabla(sql, "codigomateriaprima")
      sql = "insert into proveedormateriaprima (proveedor,materiaprima) values('" & UCase(TxtCodigo.Text) & "','" & UCase(C_Materiaprima) & "')"
      Utilidades.In_Act_Bor(Sql)
    Next
    ' Añadimos los comerciales a la tabla, si el data grid no esta vacio
    If GridComerciales.Rows.Count > 0 Then
      Numero_fila = GridComerciales.Rows.Count
      For i = 0 To Numero_fila - 1
        sql = "insert into proveedorcomercial (codigoproveedor,nombre,telefono,email) values ('" & UCase(TxtCodigo.Text) & "','" & UCase(GridComerciales[i, 0].Text) & "','" & UCase(GridComerciales[i, 1].Text) & "','" & UCase(GridComerciales[i, 2].Text) & "')"
        utilidades.In_Act_Bor(sql)   
      Next
    Endif
    Borrar_Campos_Proveedor()
  Endif
End

Public Sub BtnBorrarProveedor_Click()

  Dim Sql As String
  Dim Numero_fila As Integer
  Dim Respuesta As Integer
  Numero_fila = DtbProveedor.View.Row
  If DtbProveedor.View.Rows.Count > 0 Then
    Respuesta = Message.Delete("Desea Borrar el Proveedor : " & DtbProveedor.View[Numero_fila, 1].Text, "Si", "No")
    If respuesta = 1 Then
      ' Tabla Proveedor
      sql = "delete from proveedor where codigoproveedor='" & DtbProveedor.View[Numero_fila, 0].Text & "'" 
      Utilidades.In_Act_Bor(Sql)
      ' Tabla Proveedor Telefono
      sql = "delete from proveedortelefono where proveedor='" & DtbProveedor.View[Numero_fila, 0].Text & "'"
      Utilidades.In_Act_Bor(Sql)
      ' Tabla Proveedor Fax
      sql = "delete from proveedorfax where proveedor='" & DtbProveedor.View[Numero_fila, 0].Text & "'"
      Utilidades.In_Act_Bor(Sql)
      ' Tabla Proveedor Comercial
      sql = "delete from proveedorcomercial where codigoproveedor='" & DtbProveedor.View[Numero_fila, 0].Text & "'"
      Utilidades.In_Act_Bor(Sql)
      ' Tabla Proveedor Materia Prima
      sql = "delete from proveedormateriaprima where proveedor='" & DtbProveedor.View[Numero_fila, 0].Text & "'"
      Utilidades.In_Act_Bor(Sql)
      Configurar_DataSet_Proveedores()
     Endif
  Endif

End


Public Sub BtnEditarProveedor_Click()

  Dim Sql As String
  Dim Numero_fila As Integer 
  Dim i As Integer
  Dim C_MateriaPrima As String
  

  Numero_fila = DtbProveedor.View.Row
  If BtnEditarProveedor.text = "EDITAR" Then  
    TxtCodigo.Text = DtbProveedor.View[Numero_fila, 0].Text
    TxtRazonSocial.text = DtbProveedor.View[Numero_fila, 1].Text
    TxtNif.Text = DtbProveedor.View[Numero_fila, 2].Text
    TxtDireccion.Text = DtbProveedor.View[Numero_fila, 3].Text
    TxtLocalidad.Text = DtbProveedor.View[Numero_fila, 4].Text
    TxtProvincia.Text = DtbProveedor.View[Numero_fila, 5].Text
    TxtCodigoPostal.Text = DtbProveedor.View[Numero_fila, 6].Text
    TxtWeb.Text = DtbProveedor.View[Numero_fila, 7].Text
    TxtEmail.Text = DtbProveedor.View[Numero_fila, 8].Text
    ' Llenamos los Listbox de Telefono y Fax
    sql = "select * from proveedortelefono where proveedor='" & TxtCodigo.Text & "'"
    utilidades.Llenar_Listbox(sql, LtbTelefono, "telefono")
    sql = "select * from proveedorfax where proveedor='" & TxtCodigo.Text & "'"
    utilidades.Llenar_Listbox(sql, LtbFax, "fax")
    ' Llenamos el Listbox con las materias primas.
    sql = "select * from proveedormateriaprima where proveedor='" & TxtCodigo.text & "'"
    ' Carga los listbox de las materias primas
    Llenar_Composicion_Proveedor_MateriaPrima(sql)
    Eliminar_Materia_Prima_Listboxmp()
    ' Cargamos los datos de los comerciales en el Grid
    Llenar_DataGrid_Comerciales()

    BtnAgregarProveedor.Enabled = False
    BtnBorrarProveedor.Enabled = False
    TxtCodigo.Enabled = False
    BtnEditarProveedor.text = "ACTUALIZAR"
    
  Else
    sql = "update proveedor set razonsocial='" & UCase(TxtRazonSocial.Text) & "',nif='" & UCase(TxtNif.Text) & "',direccion='" & UCase(TxtDireccion.Text) & "',localidad='" &
    UCase(TxtLocalidad.Text) & "',provincia='" & UCase(TxtProvincia.Text) & "',codigopostal='" & UCase(TxtCodigoPostal.Text) & "',web='" & UCase(TxtWeb.Text) &
    "',email='" & UCase(TxtEmail.Text) & "' where codigoproveedor='" & UCase(TxtCodigo.Text) & "'"
    utilidades.In_Act_Bor(sql)
    ' Actualizamos Telefonos, borramos los telefonos, si el listbox de los telefonos esta vacio no hacemos nada.
    ' Si tenemos datos en el listbox de telefono los añadimos.
    sql = "delete from proveedortelefono where proveedor='" & TxtCodigo.Text & "'"
    utilidades.In_Act_Bor(sql)
    If LtbTelefono.Count > 0 Then
      For i = 0 To LtbTelefono.Count - 1
        sql = "insert into proveedortelefono (telefono,proveedor) values('" & LtbTelefono[i].Text & "','" & UCase(TxtCodigo.Text) & "')"
        Utilidades.In_Act_Bor(sql)
      Next
    Endif
    
    ' Actualizamos Fax, borramos los telefonos, si el listbox de los telefonos esta vacio no hacemos nada.
    ' Si tenemos datos en el listbox de telefono los añadimos.
    sql = "delete from proveedorfax where proveedor='" & TxtCodigo.Text & "'"
    Utilidades.In_Act_Bor(sql)    
    If LtbFax.Count > 0 Then
      For i = 0 To LtbFax.Count - 1
        sql = "insert into proveedorfax (fax,proveedor) values('" & LtbFax[i].Text & "','" & UCase(TxtCodigo.Text) & "')"
        Utilidades.In_Act_Bor(sql)
      Next
    Endif
    '' Actualizamos La materia prima que distribuye, borramos los datos de la tabla Proveedor Materia Prima y
    '' añadimos los elementos del list box
    sql = "delete from proveedormateriaprima where proveedor='" & TxtCodigo.Text & "'"
    Utilidades.In_Act_Bor(sql)    
    For i = 0 To LtBMPProveedor.Count - 1
      sql = "select * from materiaprima where nombre='" & LtBMPProveedor[i].Text & "'"
      C_Materiaprima = Utilidades.Obtener_Campo_Tabla(sql, "codigomateriaprima")
      sql = "insert into proveedormateriaprima (proveedor,materiaprima) values('" & UCase(TxtCodigo.Text) & "','" & UCase(C_Materiaprima) & "')"
      Utilidades.In_Act_Bor(Sql)
    Next
    ' Añadimos los comerciales a la tabla, si el data grid no esta vacio
    sql = "delete from proveedorcomercial where codigoproveedor='" & TxtCodigo.Text & "'"
    Utilidades.In_Act_Bor(sql)    
    If GridComerciales.Rows.Count > 0 Then
      Numero_fila = GridComerciales.Rows.Count
      For i = 0 To Numero_fila - 1
        sql = "insert into proveedorcomercial (codigoproveedor,nombre,telefono,email) values ('" & UCase(TxtCodigo.Text) & "','" & UCase(GridComerciales[i, 0].Text) & "','" & UCase(GridComerciales[i, 1].Text) & "','" & UCase(GridComerciales[i, 2].Text) & "')"
        utilidades.In_Act_Bor(sql)   
      Next
    Endif
    BtnAgregarProveedor.Enabled = True
    BtnBorrarProveedor.Enabled = True
    TxtCodigo.Enabled = True
    BtnEditarProveedor.text = "EDITAR"
    Borrar_Campos_Proveedor()
  Endif
Configurar_DataSet_Proveedores()
End
'' Configuracion de los botones de Agregar, Borra y Modificar Comerciales
Public Sub BtnAgregarComerdial_Click()
  Dim Sql As String
  Dim Numero_fila As Integer
  If Comprobar_Campos_Comercial("AGREGAR") Then
    
    Numero_fila = GridComerciales.Rows.Count
    GridComerciales.Rows.Insert(Numero_fila, 1)
    GridComerciales[Numero_fila, 0].Text = UCase(TxtNombreComercial.Text)
    GridComerciales[Numero_fila, 1].Text = UCase(TxtTelefonoComercial.Text)
    GridComerciales[Numero_fila, 2].Text = UCase(TxtEmailComercial.Text)
    TxtNombreComercial.Text = ""
    TxtTelefonoComercial.text = ""
    TxtEmailComercial.text = ""
    
  Endif

End

Public Sub BtnBorrarComercial_Click()

  Dim Sql As String
  Dim Numero_fila As Integer
  Dim Respuesta As Integer
  If GridComerciales.Rows.Selection.Count > 0 Then
    Numero_fila = GridComerciales.Rows.Selection[0]
    Respuesta = Message.Delete("Desea Borrar el Comercial : " & GridComerciales[Numero_fila, 0].Text, "Si", "No")
    If respuesta = 1 Then
      GridComerciales.Rows.Remove(Numero_fila, 1)
    End If
  End If
End

Public Sub BtnModificarComercial_Click()

  Dim Sql As String
  Dim Numero_fila As Integer
  
  If GridComerciales.Rows.Selection.Count > 0 Then
    Numero_fila = GridComerciales.Rows.Selection[0]     
  
    If LblModificarComercial.Text = "EDITAR" Then
      LblModificarComercial.Text = "ACTUALIZAR"
      TxtNombreComercial.Text = GridComerciales[Numero_fila, 0].Text 
      TxtTelefonoComercial.Text = GridComerciales[Numero_fila, 1].Text 
      TxtEmailComercial.Text = GridComerciales[Numero_fila, 2].Text 
      TxtNombreComercial.Enabled = False 
      BtnAgregarComerdial.Enabled = False
      BtnBorrarComercial.Enabled = False
      TxtNombreComercial.SetFocus
    Else
      If Comprobar_Campos_Comercial("MODIFICAR") Then
        GridComerciales.Rows.Remove(Numero_fila, 1)
        Numero_fila = GridComerciales.Rows.Count
        GridComerciales.Rows.Insert(Numero_fila, 1)
        GridComerciales[Numero_fila, 0].Text = UCase(TxtNombreComercial.Text)
        GridComerciales[Numero_fila, 1].Text = UCase(TxtTelefonoComercial.Text)
        GridComerciales[Numero_fila, 2].Text = UCase(TxtEmailComercial.Text)
        LblModificarComercial.Text = "EDITAR"
        TxtNombreComercial.Text = ""
        TxtTelefonoComercial.Text = ""
        TxtEmailComercial.Text = ""
        TxtNombreComercial.Enabled = True
        BtnAgregarComerdial.Enabled = True
        BtnBorrarComercial.Enabled = True
      Endif
     Endif
  End If
End


''*************************** Funciones privadas****************************


'' Configuracion del Dataset de Proveedores
Private Sub Configurar_DataSet_Proveedores()
  
  Dim Cabeceras As New String[]
  Dim Sql As String
  
  Cabeceras.Add("Codigo")
  Cabeceras.Add("Razon Social")
  Cabeceras.Add("Nif")
  Cabeceras.Add("Direccion")
  Cabeceras.Add("Localidad")
  Cabeceras.Add("Provincia")
  Cabeceras.Add("Codigo Postal")
  Cabeceras.Add("Web")
  Cabeceras.Add("Email")
  DtsProveedor.Connection = FMain.Conexion_Base_Datos
  sql = "select * from proveedor"
  DtsProveedor.Table = sql
  DtbProveedor.Labels = Cabeceras
  DtbProveedor.view.Columns[0].Width = 100 
  DtbProveedor.view.Columns[1].Width = 250
  DtbProveedor.view.Columns[2].Width = 100
  DtbProveedor.view.Columns[3].Width = 250
  DtbProveedor.view.Columns[4].Width = 200
  DtbProveedor.view.Columns[5].Width = 200 
  DtbProveedor.view.Columns[6].Width = 150
  DtbProveedor.view.Columns[7].Width = 250 
  DtbProveedor.view.Columns[8].Width = 100 
End
  

'' Configuracion del Datase de Comerciales<br>
'' Parametros:<br>
''    Sql --> Sentencia para cargar datos en el Dataset
Private Sub Configurar_Datagrid_Comerciales()
    
  GridComerciales.Columns.Count = 3
  GridComerciales.Header = 3
  GridComerciales.Columns[0].Title = "Nombre"
  GridComerciales.Columns[1].Title = "Telefono"
  GridComerciales.Columns[2].Title = "Email"
  GridComerciales.Columns[0].Width = 200 
  GridComerciales.Columns[1].Width = 100
  GridComerciales.Columns[2].Width = 150
  
  
  
End
'' Funcion para comprobar los Campos Proveedores <br>
''  Parametros:<br>
''      Accion - - > La accion desde la que comprobamos.<br>
''                   AGREGAR --> Para agregar datos.<br>
''                   MODIFICAR --> Cuando estamos modificando un dato.<br> 
''  Devuelve:<br>
''    TRUE --> Si los valores son correctos.<br>
''    FALSE --> valores erroneos.
Private Function Comprobar_Campos_Proveedor(Accion As String) As Boolean
  Dim Sql As String
  Dim Validar As Boolean
  Validar = True
  
  If TxtCodigo.Text = "" Then
   Balloon.Error("Debe introducir un Codigo de Proveedor que va a crear", TxtCodigo)
   Validar = False
   TxtCodigo.SetFocus
  Else If TxtRazonSocial.text = ""
   Balloon.Error("Debe introducir el Nombre del Proveedor", TxtRazonSocial)
   Validar = False
   TxtRazonSocial.SetFocus
  Else If LtBMPProveedor.Count = 0
    Balloon.Error("Debe añadir las materias primas que distribuye el proveedor", LtBMPProveedor)
    Validar = False
  Endif
  If Accion = "AGREGAR" Then
    Sql = "select * from proveedor where codigoproveedor='" & UCase(TxtCodigo.Text) & "'"
    If Utilidades.Comprobar_existe_dato(Sql) Then 
    Balloon.Error("El codigo Proveedor ya existe", TxtCodigo)
    Validar = False
    TxtCodigo.SetFocus  
   Endif 
  
 Endif 
 Return Validar
End

'' Funcion para comprobar los Campos Comercial <br>
''  Parametros:<br>
''      Accion --> Accion a realizar<br>
''        AGREGAR --> Para agregar Comerciales<br>
''        MODIFICAR --> Para modificar Comerciales<br>
''  Devuelve:<br>
''    TRUE --> Si los valores son correctos.<br>
''    FALSE --> valores erroneos.
Private Function Comprobar_Campos_Comercial(Accion As String) As Boolean
  Dim Sql As String
  Dim Validar As Boolean
  Validar = True
  If TxtNombreComercial.Text = ""
    Balloon.Error("Introduzca nombre del comercial", TxtNombreComercial)
    Validar = False
    TxtNombreComercial.SetFocus
  Else If TxtTelefonoComercial.text = "" 
    Balloon.Error("Introduzca telefono del comercial", TxtTelefonoComercial)
    Validar = False
    TxtTelefonoComercial.SetFocus
  Else If Not IsNumber(TxtTelefonoComercial.Text) 
    Balloon.Error("El Telefono es un dato Numerico", TxtTelefonoComercial)
    Validar = False
    TxtTelefonoComercial.SetFocus
  Else If TxtTelefonoComercial.Length < 9 And TxtTelefonoComercial.Length > 1
    Balloon.Error("Al Telefono le faltan digitos ", TxtTelefonoComercial)
    Validar = False
    TxtTelefonoComercial.SetFocus
  Endif
  If Accion = "AGREGAR" Then
    Sql = "select * from proveedorcomercial where nombre='" & UCase(TxtNombreComercial.Text) & "'"
    If Utilidades.Comprobar_existe_dato(Sql) Then 
      Balloon.Error("El Nombre del Comercial ya existe", TxtNombreComercial)
      Validar = False
      TxtNombreComercial.SetFocus  
    Endif 
  Endif
 Return Validar
End

'' Limpia los campos despues de uan Insercion o Modificacion de Proveedor
Private Sub Borrar_Campos_Proveedor()
  Dim Numero_fila As Integer
  TxtCodigo.Text = ""
  TxtCodigoPostal.Text = ""
  TxtDireccion.Text = ""
  TxtTelefonoComercial.Text = ""
  TxtEmail.Text = ""
  TxtEmailComercial.Text = ""
  TxtFax.Text = ""
  TxtLocalidad.Text = ""
  TxtNif.Text = ""
  TxtNombreComercial.Text = ""
  TxtProvincia.Text = ""
  TxtRazonSocial.Text = ""
  TxtTelefono.Text = ""
  TxtWeb.Text = ""
  LtBMPProveedor.Clear
  LtbFax.Clear
  LtBMP.Clear
  LtbTelefono.Clear
  Utilidades.Llenar_Listbox("select * from materiaprima", LtBMP, "nombre")
  Numero_fila = GridComerciales.Rows.Count
  If GridComerciales.Rows.Count > 0 Then
    GridComerciales.Rows.Remove(0, Numero_fila)  
  Endif
  
  Configurar_DataSet_Proveedores()
  
End



'' Procedimiento que elimina los elementos que estan en el Listbox de la composicion de los elementos del listbos de materia prima.<br>

Private Sub Eliminar_Materia_Prima_Listboxmp()
  Dim i As Integer
  Dim j As Integer
  Dim Lista_Materia_Prima As New String[]
  Dim Contador_Listobox_MP As Integer
  Dim Contador_Listobox_Composicion As Integer
  Dim Salida As Integer
  salida = 0
  j = 0
  Contador_Listobox_Composicion = LtBMPProveedor.Count
  Contador_Listobox_MP = LtBMP.Count 
  For i = 0 To Contador_Listobox_Composicion - 1
    While salida = 0
      If LtBMP[j].Text = LtBMPProveedor[i].Text Then
        salida = 1
        LtBMP.Remove(j)
      Endif
      j = j + 1
    Wend
    salida = 0
    j = 0
  Next
End

'' Procedimiento que nos llena el listbox de la composicion del articulo con el articulo seleccionado.<br>
'' Recibe como parametro la sentencia SQL
Private Sub Llenar_Composicion_Proveedor_MateriaPrima(Sql As String)
  Dim Result_Trabajo As Result
  Dim Materia_Prima As New String[]
  Dim Materia_Prima_Nombre As String
  Dim Sql_Trabajo As String
  Dim i As Integer
  Dim Contador As Integer
  LtBMPProveedor.Clear
  FMain.Conexion_Base_Datos.Close
  FMain.Conexion_Base_Datos.Open
  Result_Trabajo = FMain.Conexion_Base_Datos.Exec(Sql)
  Result_Trabajo.MoveFirst
  ' Obtenemos los identifiacores de la materia prima
  While Result_Trabajo.Available
    Materia_Prima.Add(Result_Trabajo["materiaprima"])
    Result_Trabajo.MoveNext
  Wend
    FMain.Conexion_Base_Datos.Close
    contador = Materia_Prima.Count
    LtBMPProveedor.Clear
    ' Llenamos con el nombre el Listbox.
    For i = 0 To contador - 1
      Sql_Trabajo = "select * from materiaprima where codigomateriaprima='" & Materia_Prima[i] & "'"
      Materia_Prima_Nombre = Utilidades.Obtener_Campo_Tabla(Sql_Trabajo, "nombre")
      LtBMPProveedor.Add(Materia_Prima_Nombre)
    Next
    LtBMPProveedor.UnselectAll
 
End


'' Procedimiento para llenar el Datagrid con los datos de los Comerciales del Proveedor
Private Sub Llenar_DataGrid_Comerciales()
  Dim Result_Trabajo As Result
  Dim Sql As String
  Dim Numero_fila As Integer
  sql = "Select nombre,telefono,email from proveedorcomercial where codigoproveedor='" & UCase(TxtCodigo.Text) & "'"
  FMain.Conexion_Base_Datos.Close
  FMain.Conexion_Base_Datos.Open
  Result_Trabajo = FMain.Conexion_Base_Datos.Exec(Sql)
  Result_Trabajo.MoveFirst
  
  While Result_Trabajo.Available
    Numero_fila = GridComerciales.Rows.Count
    GridComerciales.Rows.Insert(Numero_fila, 1)
    GridComerciales[Numero_fila, 0].Text = Result_Trabajo["nombre"]
    GridComerciales[Numero_fila, 1].Text = Result_Trabajo["telefono"]
    GridComerciales[Numero_fila, 2].Text = Result_Trabajo["email"]
    Result_Trabajo.MoveNext
  Wend
  
  FMain.Conexion_Base_Datos.Close
  
  
End



' ********************************************************************
Public Sub TxtCodigo_KeyRelease()

  If Key.Code = Key.Return Or Key.Code = Key.Enter Then
   TxtRazonSocial.SetFocus
  Endif

End

Public Sub TxtRazonSocial_KeyRelease()

  If Key.Code = Key.Return Or Key.Code = Key.Enter Then
   TxtDireccion.SetFocus
  Endif

End

Public Sub TxtDireccion_KeyRelease()

  If Key.Code = Key.Return Or Key.Code = Key.Enter Then
   TxtLocalidad.SetFocus
  Endif

End

Public Sub TxtLocalidad_KeyRelease()

  If Key.Code = Key.Return Or Key.Code = Key.Enter Then
   TxtProvincia.SetFocus
  Endif

End

Public Sub TxtProvincia_KeyRelease()

  If Key.Code = Key.Return Or Key.Code = Key.Enter Then
   TxtNif.SetFocus
  Endif

End

Public Sub TxtNif_KeyPress()

  If Key.Code = Key.Return Or Key.Code = Key.Enter Then
   TxtCodigoPostal.SetFocus
  Endif

End

Public Sub TxtCodigoPostal_KeyRelease()

  If Key.Code = Key.Return Or Key.Code = Key.Enter Then
   TxtWeb.SetFocus
  Endif

End

Public Sub TxtWeb_KeyRelease()

  If Key.Code = Key.Return Or Key.Code = Key.Enter Then
   TxtEmail.SetFocus
  Endif

End
'**************************************************************

Public Sub TxtNombreComercial_KeyRelease()

  If Key.Code = Key.Return Or Key.Code = Key.Enter Then
   TxtTelefonoComercial.SetFocus
  Endif

End

Public Sub TxtTelefonoComercial_KeyRelease()

  If Key.Code = Key.Return Or Key.Code = Key.Enter Then
   TxtEmailComercial.SetFocus
  Endif

End
