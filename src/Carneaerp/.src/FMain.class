' Gambas class file

' Gambas class 
' Ruta de los directorios de trabajo
Public CarpetaCarnea As String = User.home & "/carnea"
Public Carpetafacturas As String = CarpetaCarnea & "/facturas"
Public Carpetaalbaranes As String = CarpetaCarnea & "/albaranes"
Public CarpetaLogo As String = CarpetaCarnea & "/logo"
Public CarpetaTrazabilidad As String = CarpetaCarnea & "/tazabilidad"
Public CarpetaCopiasSeguridad As String = CarpetaCarnea & "/copiasseguridad"
Public DirConexion As String = User.home & "/.config/carnea/conexion"
Public FicheroConexionBD As New Settings(DirConexion & "/conexion.conf")


Public Conexion_Base_Datos As New Connection
   ' Variables para la conexion a la base de datos

'Public ConexionBD_Tipo As String = "mysql"
'Public ConexionBD_Puerto As String = "3306"

Public FacturaAlbaranAMostrar As String ' Almacenamos la ruta de la factura a mostrar que antes hemos generado en Html
Public Sub Form_Open()
  'Me.Center
  Settings.Read(Me)
  Me.Title = "CARNEA ERP. Version : " & Application.Version
  CrearDirectorios()
  Comprobarficheros()
  
End
Private Sub CargarDatosConexion()
   
  Conexion_Base_Datos.Close
  Conexion_Base_Datos.Type = "mysql"
  Conexion_Base_Datos.Host = FicheroConexionBD["ConexionBD/Host"]
  Conexion_Base_Datos.Port = FicheroConexionBD["ConexionBD/Puerto"]
  Conexion_Base_Datos.User = FicheroConexionBD["ConexionBD/Usuario"]
  Conexion_Base_Datos.Password = Utilidades.cripto(2, FicheroConexionBD["ConexionBD/Password"])
  Conexion_Base_Datos.Name = FicheroConexionBD["ConexionBD/BaseDatos"]
  
    
End


Private Sub CrearDirectorios()
  'Message.Info(CarpetaCarnea)
  ' Si no existe el directorio de trabajo es la primera ejecucion del programa.
  If Not Exist(CarpetaCarnea) Then Mkdir CarpetaCarnea 
  If Not Exist(DirConexion) Then 
    Mkdir User.Home & "/.config/carnea"
    Mkdir DirConexion
  Endif
  If Not Exist(CarpetaFacturas) Then Mkdir CarpetaFacturas
  If Not Exist(Carpetaalbaranes) Then Mkdir Carpetaalbaranes
  If Not Exist(CarpetaLogo) Then Mkdir CarpetaLogo
  If Not Exist(CarpetaTrazabilidad) Then Mkdir CarpetaTrazabilidad
  If Not Exist(CarpetaCopiasSeguridad) Then Mkdir CarpetaCopiasSeguridad
  Wait 0.5
  If Not Exist(CarpetaLogo & "/logo.png") Then Copy "./imagenes/imagenes/logo.png" To CarpetaLogo & "/logo.png"
End
Private Sub Comprobarficheros()
  
  If Not Exist(DirConexion & "/conexion.conf") Then
    Frm_Conexionbasedatos.ShowModal()  
  Else
    CargarDatosConexion()
  Endif
  
    
End


Public Sub MenuSalir_Click()

  Me.Close

End

Public Sub ButtonSalir_Click()
 Settings.write(Me)
 FMain.Conexion_Base_Datos.Close
  Me.close

End



Public Sub ButtonArticulos_Click()

  Frm_Articulos.ShowModal()

End



Public Sub ButtonuUtilidades_Click()

Frm_Utilidades.ShowModal()

End

Public Sub MenuConexionBd_Click()

  Frm_Conexionbasedatos.ShowModal()

End

Public Sub MenuArticulos_Click()

    Frm_Articulos.ShowModal()

End

Public Sub ButtonClientes_Click()

  Frm_Clientes.ShowModal()

End

Public Sub MenuClientes_Click()

  Frm_Clientes.ShowModal()

End

Public Sub Menu1_Click()

  Frm_Utilidades.ShowModal()

End

Public Sub MenuVendedores_Click()

  Frm_Vendedores.ShowModal()

End

Public Sub ButtonVendedores_Click()

  Frm_Vendedores.ShowModal()

End

Public Sub ButtonProveedores_Click()

  Frm_Proveedores.ShowModal()

End

Public Sub MenuProveedores_Click()

  Frm_Proveedores.ShowModal()

End

Public Sub ButtonCompras_Click()

  Frm_Compras.ShowModal()

End

Public Sub MenuCompras_Click()

  Frm_Compras.ShowModal()

End

Public Sub ButtonStock_Click()

  Frm_Stock.Show()

End

Public Sub MenuStock_Click()

  Frm_Stock.Show()

End

Public Sub ButtonLotes_Click()

  Frm_Lotes.ShowModal()

End

Public Sub Menu1Lotes_Click()

  Frm_Lotes.ShowModal()

End

Public Sub ButtonFacturacion_Click()

  Frm_Facturacion.ShowModal()

End

Public Sub MenuFacturacion2_Click()

  Frm_Facturacion.ShowModal()

End

Public Sub ButtonTrazabilidad_Click()

  Frm_Trazabilidad.ShowModal()

End

Public Sub MenuTrazabilidad_Click()

  Frm_Trazabilidad.ShowModal()

End

Public Sub ButtonAverias_Click()

  Frm_Averias.Show()

End

Public Sub ButtonCopias_Click()

  Frm_CopiasSeguridad.Show()

End

Public Sub MenuCopiasSeguridad_Click()

    Frm_CopiasSeguridad.Show()

End

Public Sub ButtonInformes_Click()

  Frm_Informes.Show()

End

Public Sub MenuInformes_Click()

    Frm_Informes.Show()

End

Public Sub Form_Close()

  FMain.Conexion_Base_Datos.Close

End

Public Sub MenuFacturacion3_Click()

  Frm_Facturacion.ShowModal()

End

Public Sub MenuEdicionFactuasAlbaranes_Click()

  Frm_Visualizar_Factura_Albaran.ShowModal()  

End

Public Sub MenuFacturarAlbaranes_Click()

  Frm_FacturacionAlbaranes.ShowModal()

End

Public Sub MenuPasoContabilidad_Click()

  Frm_PasoContabilidad.Show()

End
